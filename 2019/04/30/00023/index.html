<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.2.0">
<meta name="referrer" content="no-referrer"/>
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">
<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">
  <link rel="stylesheet" href="/lib/pace/pace-theme-minimal.min.css">
  <script src="/lib/pace/pace.min.js"></script>

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"dzapathy.github.io","root":"/","scheme":"Mist","version":"7.7.1","exturl":false,"sidebar":{"position":"right","display":"hide","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":true,"style":"flat"},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":true,"lazyload":true,"pangu":true,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta property="og:type" content="article">
<meta property="og:title" content="计算机网络-应用层">
<meta property="og:url" content="https://dzapathy.github.io/2019/04/30/00023/index.html">
<meta property="og:site_name" content="Apathy">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://i.loli.net/2020/02/15/FrV1DlE8kLepw9o.jpg">
<meta property="og:image" content="https://i.loli.net/2019/05/01/5cc97ed6b1659.jpg">
<meta property="og:image" content="http://wx3.sinaimg.cn/mw690/9f1bc5a3ly1g2m3je77w5j209v07fmxd.jpg">
<meta property="og:image" content="http://wx4.sinaimg.cn/mw690/9f1bc5a3ly1g2m3ovdd3gj20iu072n0t.jpg">
<meta property="og:image" content="http://wx3.sinaimg.cn/mw690/9f1bc5a3ly1g2mr1pe0skj208w07rjrt.jpg">
<meta property="og:image" content="http://wx1.sinaimg.cn/mw690/9f1bc5a3ly1g2oc6y9wjtj20ec0bkn04.jpg">
<meta property="og:image" content="http://wx3.sinaimg.cn/mw690/9f1bc5a3ly1g2mutpcdlwj20hz0810v4.jpg">
<meta property="og:image" content="http://wx2.sinaimg.cn/mw690/9f1bc5a3ly1g2mwyyx1rtj20ip0atn0x.jpg">
<meta property="article:published_time" content="2019-04-30T03:55:50.000Z">
<meta property="article:modified_time" content="2020-02-15T11:39:43.547Z">
<meta property="article:author" content="Apathy">
<meta property="article:tag" content="Code">
<meta property="article:tag" content="Computer Network">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://i.loli.net/2020/02/15/FrV1DlE8kLepw9o.jpg">

<link rel="canonical" href="https://dzapathy.github.io/2019/04/30/00023/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome: false,
    isPost: true
  };
</script>

  <title>计算机网络-应用层 | Apathy</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <div>
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Apathy</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
  </div>

  <div class="site-nav-right"></div>
</div>


<nav class="site-nav">
  
  <ul id="menu" class="menu">
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-fw fa-user"></i>About</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i>Tags</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>Archives</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>

</nav>
  <div class="site-search">
    <div class="popup search-popup">
    <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocorrect="off" autocapitalize="off"
           placeholder="Searching..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result"></div>

</div>
<div class="search-pop-overlay"></div>

  </div>
</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content">
            

  <div class="posts-expand">
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block " lang="en">
    <link itemprop="mainEntityOfPage" href="https://dzapathy.github.io/2019/04/30/00023/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="http://wx4.sinaimg.cn/mw690/006qmw33ly8fzvcxv7effj30ru0ruaby.jpg">
      <meta itemprop="name" content="Apathy">
      <meta itemprop="description" content="没有肆意生长的野心<br>哪来梦想的星辰大海">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Apathy">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          计算机网络-应用层
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2019-04-30 11:55:50" itemprop="dateCreated datePublished" datetime="2019-04-30T11:55:50+08:00">2019-04-30</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-02-15 19:39:43" itemprop="dateModified" datetime="2020-02-15T19:39:43+08:00">2020-02-15</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p><img data-src="https://i.loli.net/2020/02/15/FrV1DlE8kLepw9o.jpg" alt="Krakatoa_ZH-CN8471800710_1920x1080.jpg"></p>
<a id="more"></a>

<blockquote>
<p><a href="https://www.icourse163.org/course/HIT-154005" target="_blank" rel="noopener">计算机网络视频</a><br><a href="https://dzapathy.github.io/2019/03/17/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C-%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/">计算机网络-基础知识</a><br><a href="https://dzapathy.github.io/2019/04/30/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C-%E5%BA%94%E7%94%A8%E5%B1%82/">计算机网络-应用层</a><br><a href="https://dzapathy.github.io/2019/04/30/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C-%E4%BC%A0%E8%BE%93%E5%B1%82/">计算机网络-传输层</a><br><a href="https://dzapathy.github.io/2019/04/30/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C-%E7%BD%91%E7%BB%9C%E5%B1%82/">计算机网络-网络层</a><br><a href="https://dzapathy.github.io/2019/04/30/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C-%E7%BD%91%E7%BB%9C%E5%B1%82/">计算机网络-数据链路层</a></p>
</blockquote>
<p>应用层是提供不同主机之间进程和进程的通信，应用层的数据单位是报文。常见的应用层协议包括：</p>
<ul>
<li>Web：HTTP、HTTPS</li>
<li>Email：SMTP、POP3、IMAP</li>
<li>File：FTP</li>
</ul>
<h2 id="网络应用的体系结构"><a href="#网络应用的体系结构" class="headerlink" title="网络应用的体系结构"></a>网络应用的体系结构</h2><ul>
<li>C/S：客户端-服务器</li>
<li>P2P：没有明确客户端和服务器的角色</li>
<li>混合结构：比如文件传输使用 P2P 结构，文件搜索使用 C/S 结构</li>
</ul>
<h2 id="Web-应用"><a href="#Web-应用" class="headerlink" title="Web 应用"></a>Web 应用</h2><blockquote>
<p><a href="https://cyc2018.github.io/CS-Notes/#/notes/HTTP" target="_blank" rel="noopener">HTTP</a></p>
<p><a href="https://www.cnblogs.com/blackgan/p/11107317.html" target="_blank" rel="noopener">多进程多线程浏览器</a></p>
</blockquote>
<p>HTTP 协议是一个无状态的协议，如果设计成有状态的协议，维护状态需要进行非常复杂的处理。HTTP 默认是持久性连接。</p>
<ul>
<li>非持久性连接：一个 TCP 连接只能处理一个 HTTP 请求</li>
<li>持久性连接：一个 TCP 连接能够处理多个 HTTP 请求</li>
</ul>
<p>HTTP 包括请求消息和响应消息，首部包括通用首部字段、请求首部字段、响应首部字段和实体首部字段。</p>
<ul>
<li>host：主机号在缓存或代理中使用</li>
</ul>
<h2 id="DNS-应用"><a href="#DNS-应用" class="headerlink" title="DNS 应用"></a>DNS 应用</h2><p>域名解析系统 DNS 是将域名解析为 IP 地址的分布式分层数据库。DNS 提供以下几种服务：</p>
<ul>
<li>将域名映射成 IP 地址</li>
<li>主机别名</li>
<li>邮件服务器别名</li>
<li>负载均衡：在进行域名向 IP 地址的映射时，可以提供多个 IP 地址</li>
</ul>
<h3 id="分布式"><a href="#分布式" class="headerlink" title="分布式"></a>分布式</h3><p>域名并不完全存储于一个服务器中，每个 DNS 服务器只保留它自己的数据。</p>
<h3 id="分层"><a href="#分层" class="headerlink" title="分层"></a>分层</h3><p><img data-src="https://i.loli.net/2019/05/01/5cc97ed6b1659.jpg" alt="pic"></p>
<p>域名具有层次结构，从上到下依次是：根域名、顶级域名、二级域名…</p>
<ul>
<li>根域名服务器：全球有 13 个根域名服务器</li>
<li>顶级域名服务器：负责 <code>edu</code>、 <code>com</code> 、 <code>org</code> 等顶级域名</li>
<li>权威域名服务器：组织的域名解析服务器，负责组织内部的域名解析</li>
<li>本地域名服务器：每个 ISP 都有一个本地域名服务器。本地域名服务器是默认的域名解析服务器，当主机进行 DNS 查询时，查询被发送到本地域名服务器，本地域名服务器作为代理将查询转发给域名解析系统。</li>
</ul>
<h3 id="迭代查询-amp-递归查询"><a href="#迭代查询-amp-递归查询" class="headerlink" title="迭代查询 &amp; 递归查询"></a>迭代查询 &amp; 递归查询</h3><p>域名查询分为两种：迭代查询和递归查询</p>
<p>若客户端想要查询 <code>dzapathy.github.io</code> 的 IP，迭代查询的流程如下：</p>
<ul>
<li><p>首先主机将查询发送给本地域名服务器</p>
</li>
<li><p>本地域名服务器无法解析域名时，本地域名服务器作为代理转发查询访问根域名服务器</p>
</li>
<li><p>根域名服务器无法解析域名时，返回顶级域名服务器  <code>io</code>  </p>
</li>
<li><p>本地域名服务器查询顶级域名解析服务器 <code>io</code></p>
</li>
<li><p>顶级域名解析服务器无法解析域名时，返回权威域名服务器 <code>github.io</code></p>
</li>
<li><p>本地域名服务器查询权威域名服务器 <code>github.io</code></p>
</li>
<li><p>权威域名服务器 <code>github.io</code> 返回  <code>dzapathy.github.io</code>  的 IP 地址</p>
</li>
<li><p>本地域名服务器将 <code>dzapathy.github.io</code> 的 IP 地址返回给客户端</p>
</li>
</ul>
<p>若客户端想要查询 <code>dzapathy.github.io</code> 的 IP，递归查询的流程如下：</p>
<ul>
<li><p>首先主机将查询发送给本地域名服务器</p>
</li>
<li><p>本地域名服务器无法解析域名时，本地域名服务器作为代理转发查询访问根域名服务器</p>
</li>
<li><p>根域名服务器无法解析域名时，查询顶级域名服务器  <code>io</code>  </p>
</li>
<li><p>顶级域名服务器无法解析域名时，查询权威域名服务器 <code>github.io</code></p>
</li>
<li><p>权威域名服务器 <code>github.io</code> 返回  <code>dzapathy.github.io</code>  的 IP 地址给顶级域名服务器</p>
</li>
<li><p>顶级域名服务器返回给根域名服务器</p>
</li>
<li><p>根域名服务器返回给本地域名服务器</p>
</li>
<li><p>本地域名服务器将 <code>dzapathy.github.io</code> 的 IP 地址返回给客户端</p>
</li>
</ul>
<h3 id="查询区别"><a href="#查询区别" class="headerlink" title="查询区别"></a>查询区别</h3><ul>
<li>迭代查询本地服务器会发送多次查询请求，递归查询本地服务器会发送一次查询请求</li>
<li>递归查询域名解析系统需要维护并转发查询请求，而迭代查询只需要响应一次查询请求</li>
<li>一般主机和本地服务器之间使用递归查询，本地服务器和域名解析系统之间使用迭代查找</li>
</ul>
<h3 id="缓存"><a href="#缓存" class="headerlink" title="缓存"></a>缓存</h3><p>本地域名服务器一般会缓存顶级域名服务器的映射</p>
<h3 id="DNS-记录"><a href="#DNS-记录" class="headerlink" title="DNS 记录"></a>DNS 记录</h3><p>格式：$(name, value,type,ttl)$，$ttl$ 表示时间有效性</p>
<p><code>type = A</code> 时，<code>name</code> 表示主机域名，<code>value</code> 表示 IP 地址</p>
<p><code>type = NS</code> 时，<code>name</code> 表示域（比如<code>edu.cn</code>），<code>value</code> 表示权威域名服务器的主机域名</p>
<p><code>type = CNAME</code> 时，<code>name</code> 表示真实域名的别名，<code>value</code> 表示真实域名</p>
<p><code>type = MS</code> 时，<code>value</code> 是与 <code>name</code> 相对应的邮件服务器</p>
<h3 id="DNS-底层协议"><a href="#DNS-底层协议" class="headerlink" title="DNS 底层协议"></a>DNS 底层协议</h3><p>DNS 可以使用 UDP 或 TCP 进行传输，使用的端口号都为 53。大多数情况下 DNS 使用 UDP 进行传输，这就要求域名解析器和域名服务器都必须自己处理超时和重传从而保证可靠性。在两种情况下会使用 TCP 进行传输：</p>
<ul>
<li>如果返回的响应超过的 512 字节（UDP 最大只支持 512 字节的数据）</li>
<li>区域传送（区域传送是主域名服务器向辅助域名服务器传送变化的那部分数据）</li>
</ul>
<h2 id="Email-应用"><a href="#Email-应用" class="headerlink" title="Email 应用"></a>Email 应用</h2><p>Email 应用包括邮件客户端、邮件服务器和邮件协议。邮件协议包含发送协议和读取协议，发送协议通常使用 SMTP 协议，读取协议通常使用 POP3 或 IMAP 协议。</p>
<ul>
<li>邮件客户端：发送、接收邮件</li>
<li>邮件服务器：为每一个用户分配一个邮箱，并使用一个消息队列存储等待发送的邮件</li>
<li>邮件协议：邮件服务器之间传递消息所使用的协议</li>
</ul>
<h3 id="发送协议"><a href="#发送协议" class="headerlink" title="发送协议"></a>发送协议</h3><p>SMTP 协议是发送协议，依赖于 TCP 协议，使用命令 / 响应模式进行交互，SMTP 占用的端口号是 25 。</p>
<ul>
<li>持久性连接：只建立一次 TCP 请求</li>
<li>消息必须使用 7 位 ASCII 码</li>
<li>SMTP 使用回车换行确认消息结束</li>
</ul>
<h3 id="消息格式"><a href="#消息格式" class="headerlink" title="消息格式"></a>消息格式</h3><h4 id="SMTP"><a href="#SMTP" class="headerlink" title="SMTP"></a>SMTP</h4><p><img data-src="http://wx3.sinaimg.cn/mw690/9f1bc5a3ly1g2m3je77w5j209v07fmxd.jpg" alt="pic"></p>
<ul>
<li><p>header：To、From、Subject</p>
</li>
<li><p>body：消息本身，只能是 ASCII</p>
</li>
</ul>
<h4 id="MIME"><a href="#MIME" class="headerlink" title="MIME"></a>MIME</h4><p>为了进行多媒体邮件扩展，在邮件头部增加额外的行声明 MIME 的内容类型，来支持发送多媒体。MIME 可以发送二进制文件，MIME 并没有改动或者取代 SMTP，而是增加邮件主体的结构，定义了非 ASCII 码的编码规则</p>
<p><img data-src="http://wx4.sinaimg.cn/mw690/9f1bc5a3ly1g2m3ovdd3gj20iu072n0t.jpg" alt="pic"></p>
<h3 id="读取协议"><a href="#读取协议" class="headerlink" title="读取协议"></a>读取协议</h3><p>邮件读取协议又称邮件访问协议，主要有 POP3 和 IMAP 协议。</p>
<ul>
<li>POP3：提供认证/授权和下载功能，无状态协议</li>
<li>IMAP：更复杂，更多功能，能够操纵邮件服务器上的消息</li>
<li>HTTP：网页邮件</li>
</ul>
<h4 id="POP3"><a href="#POP3" class="headerlink" title="POP3"></a>POP3</h4><ul>
<li>认证过程：客户端发送用户名和密码，服务端响应</li>
<li>事务阶段：<ul>
<li>List：列出消息数量</li>
<li>Retr：用编号获取消息</li>
<li>Dete：删除邮件</li>
<li>Quit：退出</li>
<li>…</li>
</ul>
</li>
</ul>
<p>POP3 模式：</p>
<ul>
<li><p>下载并删除：下载后在服务器删除</p>
</li>
<li><p>下载并保持：下载后服务器也会继续保存，支持不同客户端多次浏览</p>
</li>
</ul>
<h4 id="IMAP"><a href="#IMAP" class="headerlink" title="IMAP"></a>IMAP</h4><ul>
<li>所有消息保存在服务器上</li>
<li>允许用户利用文件夹组织信息</li>
<li>IMAP 是有状态协议</li>
</ul>
<h2 id="P2P-应用"><a href="#P2P-应用" class="headerlink" title="P2P 应用"></a>P2P 应用</h2><p>P2P 没有明确的客户端和服务器的角色，而是点对点的应用，P2P 采用共享的机制分发文件。</p>
<h3 id="危害"><a href="#危害" class="headerlink" title="危害"></a>危害</h3><ul>
<li>占用网络带宽</li>
<li>助长病毒传播</li>
<li>版权问题</li>
</ul>
<h3 id="索引"><a href="#索引" class="headerlink" title="索引"></a>索引</h3><ul>
<li><p>集中式索引</p>
<p>节点加入时将 IP 和持有的内容通知给中央服务器，中央服务器去维护所有节点的索引信息。集中索引存在单点故障、性能瓶颈、版权等问题</p>
</li>
<li><p>洪泛式查询</p>
<p>完全分布式的架构，每个节点对它共享的文件进行索引且只对它共享的文件进行索引。查询时向已有的 TCP 连接发送查询请求，任何收到查询请求的节点会转发查询请求。如果查询命中，利用反向路径发回查询节点</p>
</li>
<li><p>层次式覆盖网络</p>
<p>层次式覆盖网络是介于集中式索引和洪泛式查询之间的方法。网络节点分为两类：普通节点和超级节点。普通节点只和超级节点建立 TCP 连接，这部分可以看成集中式索引；超级节点维护索引信息，超级节点之间建立 TCP 连接，这部分可以看成洪泛式查询</p>
<p><img data-src="http://wx3.sinaimg.cn/mw690/9f1bc5a3ly1g2mr1pe0skj208w07rjrt.jpg" alt="pic"></p>
</li>
</ul>
<h2 id="FTP"><a href="#FTP" class="headerlink" title="FTP"></a>FTP</h2><blockquote>
<p><a href="https://cyc2018.github.io/CS-Notes/#/notes/计算机网络%20-%20应用层?id=文件传送协议" target="_blank" rel="noopener">FTP</a></p>
</blockquote>
<h2 id="DHCP"><a href="#DHCP" class="headerlink" title="DHCP"></a>DHCP</h2><blockquote>
<p><a href="https://cyc2018.github.io/CS-Notes/#/notes/计算机网络%20-%20应用层?id=动态主机配置协议" target="_blank" rel="noopener">DHCP</a></p>
</blockquote>
<p>一个主机如何获取 IP 地址：</p>
<ul>
<li>静态配置： IP 地址、子网、默认网关和本地域名服务器 DNS</li>
<li>动态配置：动态主机配置协议 DHCP，从 DHCP 服务器获取 IP 地址。DHCP 能够保证主机即插即用，并且允许地址重用</li>
</ul>
<p>过程：</p>
<ul>
<li>主机发送”DHCP discover”发现报文，源 IP 地址和端口号是 $0.0.0.0:68$，目的 IP 地址和端口号是 $255.255.255.255:67$。广播的原因是为了发现子网内的 DHCP 服务器</li>
<li>DHCP 服务器利用”DHCP offer“ 提供报文进行响应，DHCP 进行广播的原因是因为此时主机还没有 IP 地址</li>
<li>主机发送 ”DHCP request“ 请求报文，继续广播，原因是可能有多个 IP 地址，主机携带接受的 IP ，其他 DHCP 服务器可以为其他主机分配 IP</li>
<li>DHCP 服务器发送”DHCP ACK“ 确认报文，DHCP 进行广播的原因是因为此时主机还没有 IP 地址，最后主机动态分配了一个 IP 地址</li>
</ul>
<p><img data-src="http://wx1.sinaimg.cn/mw690/9f1bc5a3ly1g2oc6y9wjtj20ec0bkn04.jpg" alt="pic"></p>
<p>不过客户获取的IP一般是用租期，到期前需要更新租期</p>
<ul>
<li>当租期使用 50% ，客户端直接向为其提供 IP 的DHCP 服务器发送 DHCP request 报文</li>
<li>如果收到 DHCP 服务器 ACK 报文更新租期；如果没有收到 ACK 报文继续使用</li>
<li>当租期使用 87.5% ，再次向为其提供 IP 的DHCP 服务器发送 DHCP request 报文</li>
<li>如果收到 DHCP 服务器 ACK 报文更新租期；如果没有收到 ACK 报文发送 DHCP offer 重新获取 IP</li>
</ul>
<h2 id="TELNET"><a href="#TELNET" class="headerlink" title="TELNET"></a>TELNET</h2><p>TELNET 用于登录到远程主机上，并且远程主机上的输出也会返回。TELNET 可以适应许多计算机和操作系统的差异，例如不同操作系统系统的换行符定义</p>
<h2 id="网络编程"><a href="#网络编程" class="headerlink" title="网络编程"></a>网络编程</h2><p>Socket API 对外使用 IP 地址和端口号来区分 Socket，对内操作系统使用套接字描述符来区分 Socket 。每个进程有一个端口号，可以有多个 Socket 。每个进程维护一个 Socket 描述符表，存储套接字描述符，套接字描述符指向对应的 Socket 数据结构。Socket 数据结构中包含源 IP 地址，源端口号，目的 IP 地址和目的端口号，以此来区分唯一 Socket 连接</p>
<p><img data-src="http://wx3.sinaimg.cn/mw690/9f1bc5a3ly1g2mutpcdlwj20hz0810v4.jpg" alt="pic"></p>
<p>端口号的范围是$0 \sim 65535$，其中 $0 \sim 1023$ 是知名端口号， $1024 \sim 65535$ 动态端口号。知名端口号为特定的网络应用提供服务端口</p>
<p><img data-src="http://wx2.sinaimg.cn/mw690/9f1bc5a3ly1g2mwyyx1rtj20ip0atn0x.jpg" alt="pic"></p>
<h3 id="处理单个连接请求"><a href="#处理单个连接请求" class="headerlink" title="处理单个连接请求"></a>处理单个连接请求</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.apathy;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.BufferedInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.BufferedOutputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.DataInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.DataOutputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.net.ServerSocket;</span><br><span class="line"><span class="keyword">import</span> java.net.Socket;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SocketServer</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 单个连接的demo</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        ServerSocket serverSocket = <span class="keyword">new</span> ServerSocket(<span class="number">9000</span>); <span class="comment">// 创建 Socket</span></span><br><span class="line">        Socket socket = serverSocket.accept(); <span class="comment">// 监听客户端连接</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 创建输入输出流</span></span><br><span class="line">        DataInputStream dis = <span class="keyword">new</span> DataInputStream(</span><br><span class="line">            <span class="keyword">new</span> BufferedInputStream(socket.getInputStream()));</span><br><span class="line">        DataOutputStream dos = <span class="keyword">new</span> DataOutputStream(</span><br><span class="line">            <span class="keyword">new</span> BufferedOutputStream(socket.getOutputStream()));</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span>(<span class="keyword">true</span>) &#123;</span><br><span class="line">            <span class="keyword">double</span> length = dis.readDouble();</span><br><span class="line">            <span class="keyword">if</span>(length &lt; <span class="number">0</span>)</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            System.out.println(<span class="string">"服务器端收到的正方形边为："</span> + length);</span><br><span class="line">            <span class="keyword">double</span> result = length * length;</span><br><span class="line">            dos.writeDouble(result);</span><br><span class="line">            dos.flush();</span><br><span class="line">        &#125;</span><br><span class="line">        socket.close();</span><br><span class="line">        serverSocket.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.apathy;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.BufferedInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.BufferedOutputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.DataInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.DataOutputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.net.Socket;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SocketClient</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        Socket socket = <span class="keyword">new</span> Socket(<span class="string">"localhost"</span>, <span class="number">9000</span>);</span><br><span class="line"></span><br><span class="line">        DataInputStream dis = <span class="keyword">new</span> DataInputStream(</span><br><span class="line">            <span class="keyword">new</span> BufferedInputStream(socket.getInputStream()));</span><br><span class="line">        DataOutputStream dos = <span class="keyword">new</span> DataOutputStream(</span><br><span class="line">            <span class="keyword">new</span> BufferedOutputStream(socket.getOutputStream()));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 使用 for 循环模拟多次计算</span></span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">5</span>; i &gt;= <span class="number">0</span>; i--) &#123;</span><br><span class="line">            System.out.println(<span class="string">"请输入正方形边长（小于0退出）"</span>);</span><br><span class="line">            <span class="keyword">double</span> length = i - <span class="number">0.5</span>;</span><br><span class="line">            dos.writeDouble(length);</span><br><span class="line">            dos.flush();</span><br><span class="line">            <span class="keyword">if</span>(length &lt; <span class="number">0</span>)</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">double</span> res = dis.readDouble();</span><br><span class="line">            System.out.println(<span class="string">"计算结果为："</span> + res);</span><br><span class="line">        &#125;</span><br><span class="line">        socket.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="处理多个连接请求"><a href="#处理多个连接请求" class="headerlink" title="处理多个连接请求"></a>处理多个连接请求</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.apathy;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.BufferedInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.BufferedOutputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.DataInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.DataOutputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.net.ServerSocket;</span><br><span class="line"><span class="keyword">import</span> java.net.Socket;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.ExecutorService;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.Executors;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.atomic.AtomicInteger;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SocketServer</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        ServerSocket serverSocket = <span class="keyword">new</span> ServerSocket(<span class="number">8888</span>);</span><br><span class="line">        AtomicInteger number = <span class="keyword">new</span> AtomicInteger();</span><br><span class="line"></span><br><span class="line">        ExecutorService exec = Executors.newCachedThreadPool();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line">                Socket socket = serverSocket.accept();</span><br><span class="line">                exec.execute(<span class="keyword">new</span> SimpleServer(socket, number.getAndIncrement()));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            serverSocket.close();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SimpleServer</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Socket socket;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> num;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">SimpleServer</span><span class="params">(Socket socket, <span class="keyword">int</span> num)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.socket = socket;</span><br><span class="line">        <span class="keyword">this</span>.num = num;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        DataInputStream dis = <span class="keyword">null</span>;</span><br><span class="line">        DataOutputStream dos = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            System.out.println(<span class="string">"客户端 "</span> + num + <span class="string">"建立连接"</span>);</span><br><span class="line">            dis = <span class="keyword">new</span> DataInputStream(<span class="keyword">new</span> BufferedInputStream(socket.getInputStream()));</span><br><span class="line">            dos = <span class="keyword">new</span> DataOutputStream(<span class="keyword">new</span> BufferedOutputStream(socket.getOutputStream()));</span><br><span class="line">            <span class="keyword">while</span>(<span class="keyword">true</span>) &#123;</span><br><span class="line">                <span class="keyword">double</span> length = dis.readDouble();</span><br><span class="line">                <span class="keyword">if</span>(length &lt; <span class="number">0</span>)</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                System.out.println(<span class="string">"收到客户端 "</span> + num+ <span class="string">" 的正方形边为："</span> + length);</span><br><span class="line">                <span class="keyword">double</span> result = length * length;</span><br><span class="line">                dos.writeDouble(result);</span><br><span class="line">                dos.flush();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span>(IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="keyword">if</span>(dis != <span class="keyword">null</span>)</span><br><span class="line">                    dis.close();</span><br><span class="line">                <span class="keyword">if</span>(dos != <span class="keyword">null</span>)</span><br><span class="line">                    dos.close();</span><br><span class="line">                socket.close();</span><br><span class="line">            &#125;<span class="keyword">catch</span>(IOException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="异步-IO-处理多个请求"><a href="#异步-IO-处理多个请求" class="headerlink" title="异步 IO 处理多个请求"></a>异步 IO 处理多个请求</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 服务端</span></span><br><span class="line"><span class="keyword">package</span> com.apathy;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.net.InetSocketAddress;</span><br><span class="line"><span class="keyword">import</span> java.net.ServerSocket;</span><br><span class="line"><span class="keyword">import</span> java.nio.ByteBuffer;</span><br><span class="line"><span class="keyword">import</span> java.nio.channels.SelectionKey;</span><br><span class="line"><span class="keyword">import</span> java.nio.channels.Selector;</span><br><span class="line"><span class="keyword">import</span> java.nio.channels.ServerSocketChannel;</span><br><span class="line"><span class="keyword">import</span> java.nio.channels.SocketChannel;</span><br><span class="line"><span class="keyword">import</span> java.util.Iterator;</span><br><span class="line"><span class="keyword">import</span> java.util.Set;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SocketNIOService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException</span>&#123;</span><br><span class="line">        Selector sel = Selector.open(); <span class="comment">// 创建选择器</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 创建ServerSocketChannel，监听新进来的TCP连接</span></span><br><span class="line">        ServerSocketChannel socketChannel = ServerSocketChannel.open();</span><br><span class="line">        socketChannel.configureBlocking(<span class="keyword">false</span>); <span class="comment">// 设置非阻塞 IO</span></span><br><span class="line">        <span class="comment">/* 将通道注册到选择器上</span></span><br><span class="line"><span class="comment">        SelectionKey.OP_CONNECT:连接就绪，一个Channel成功连接到另一个服务器</span></span><br><span class="line"><span class="comment">        SelectionKey.OP_ACCEPT：接收就绪，一个ServerSocketChannel准备好接收新进入的连接</span></span><br><span class="line"><span class="comment">        SelectionKey.OP_READ：读就绪，一个有数据可读的通道</span></span><br><span class="line"><span class="comment">        SelectionKey.OP_WRITE：写就绪，一个等待写数据的通道</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line">        socketChannel.register(sel, SelectionKey.OP_ACCEPT);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 将 ServerSocketChannel 绑定到特定端口</span></span><br><span class="line">        ServerSocket serverSocket = socketChannel.socket(); <span class="comment">// 创建套接字</span></span><br><span class="line">        InetSocketAddress address = <span class="keyword">new</span> InetSocketAddress(<span class="string">"127.0.0.1"</span>, <span class="number">8888</span>);</span><br><span class="line">        serverSocket.bind(address); <span class="comment">// 绑到特定端口</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span>(<span class="keyword">true</span>) &#123;</span><br><span class="line">            sel.select(); <span class="comment">// 监听事件，没有事件会阻塞</span></span><br><span class="line">            Set&lt;SelectionKey&gt; set = sel.selectedKeys(); <span class="comment">// 获取到达的事件</span></span><br><span class="line">            Iterator&lt;SelectionKey&gt; iterator = set.iterator(); <span class="comment">// 使用迭代器遍历</span></span><br><span class="line">            <span class="keyword">while</span>(iterator.hasNext()) &#123; <span class="comment">// 轮询</span></span><br><span class="line">                SelectionKey key = iterator.next();</span><br><span class="line">                <span class="keyword">if</span>(key.isAcceptable()) &#123;  <span class="comment">// 连接就绪</span></span><br><span class="line">                    <span class="comment">// 如果是连接请求，将连接通道注册到 selector 上</span></span><br><span class="line">                    ServerSocketChannel ssc = (ServerSocketChannel)key.channel();</span><br><span class="line">                    SocketChannel sc = ssc.accept();</span><br><span class="line">                    sc.configureBlocking(<span class="keyword">false</span>);</span><br><span class="line">                    sc.register(sel, SelectionKey.OP_READ);</span><br><span class="line">                &#125; <span class="keyword">else</span> <span class="keyword">if</span>(key.isReadable()) &#123;  <span class="comment">// 读就绪</span></span><br><span class="line">                    SocketChannel sc = (SocketChannel) key.channel();</span><br><span class="line">                    System.out.println(readDataFromSocketChannel(sc));</span><br><span class="line">                    sc.close();</span><br><span class="line">                &#125;</span><br><span class="line">                iterator.remove();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> String <span class="title">readDataFromSocketChannel</span><span class="params">(SocketChannel sChannel)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line"></span><br><span class="line">        ByteBuffer buffer = ByteBuffer.allocate(<span class="number">1024</span>);</span><br><span class="line">        StringBuilder data = <span class="keyword">new</span> StringBuilder();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line">            buffer.clear();</span><br><span class="line">            <span class="keyword">int</span> n = sChannel.read(buffer);</span><br><span class="line">            <span class="keyword">if</span> (n == -<span class="number">1</span>) &#123;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            buffer.flip();</span><br><span class="line">            <span class="keyword">int</span> limit = buffer.limit();</span><br><span class="line">            <span class="keyword">char</span>[] dst = <span class="keyword">new</span> <span class="keyword">char</span>[limit];</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; limit; i++) &#123;</span><br><span class="line">                dst[i] = (<span class="keyword">char</span>) buffer.get(i);</span><br><span class="line">            &#125;</span><br><span class="line">            data.append(dst);</span><br><span class="line">            buffer.clear();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> data.toString();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 客户端</span></span><br><span class="line"><span class="keyword">package</span> com.apathy;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.OutputStream;</span><br><span class="line"><span class="keyword">import</span> java.net.Socket;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SocketNIOClient</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException</span>&#123;</span><br><span class="line">        Socket socket = <span class="keyword">new</span> Socket(<span class="string">"127.0.0.1"</span>, <span class="number">8888</span>);</span><br><span class="line">        OutputStream ops = socket.getOutputStream();</span><br><span class="line">        String str = <span class="string">"hello, apathy"</span>;</span><br><span class="line">        ops.write(str.getBytes());</span><br><span class="line">        ops.close();</span><br><span class="line">        socket.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

    </div>

    
    
    
        <div class="reward-container">
  <div></div>
  <button onclick="var qr = document.getElementById('qr'); qr.style.display = (qr.style.display === 'none') ? 'block' : 'none';">
    Donate
  </button>
  <div id="qr" style="display: none;">
      
      <div style="display: inline-block;">
        <img src="/images/wechatpay.png" alt="Apathy WeChat Pay">
        <p>WeChat Pay</p>
      </div>

  </div>
</div>


      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/Code/" rel="tag"># Code</a>
              <a href="/tags/Computer-Network/" rel="tag"># Computer Network</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2019/04/27/00022/" rel="prev" title="操作系统-进程管理">
      <i class="fa fa-chevron-left"></i> 操作系统-进程管理
    </a></div>
      <div class="post-nav-item">
    <a href="/2019/04/30/00024/" rel="next" title="计算机网络-传输层">
      计算机网络-传输层 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  

  </div>


          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let activeClass = CONFIG.comments.activeClass;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#网络应用的体系结构"><span class="nav-number">1.</span> <span class="nav-text">网络应用的体系结构</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Web-应用"><span class="nav-number">2.</span> <span class="nav-text">Web 应用</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#DNS-应用"><span class="nav-number">3.</span> <span class="nav-text">DNS 应用</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#分布式"><span class="nav-number">3.1.</span> <span class="nav-text">分布式</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#分层"><span class="nav-number">3.2.</span> <span class="nav-text">分层</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#迭代查询-amp-递归查询"><span class="nav-number">3.3.</span> <span class="nav-text">迭代查询 &amp; 递归查询</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#查询区别"><span class="nav-number">3.4.</span> <span class="nav-text">查询区别</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#缓存"><span class="nav-number">3.5.</span> <span class="nav-text">缓存</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#DNS-记录"><span class="nav-number">3.6.</span> <span class="nav-text">DNS 记录</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#DNS-底层协议"><span class="nav-number">3.7.</span> <span class="nav-text">DNS 底层协议</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Email-应用"><span class="nav-number">4.</span> <span class="nav-text">Email 应用</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#发送协议"><span class="nav-number">4.1.</span> <span class="nav-text">发送协议</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#消息格式"><span class="nav-number">4.2.</span> <span class="nav-text">消息格式</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#SMTP"><span class="nav-number">4.2.1.</span> <span class="nav-text">SMTP</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#MIME"><span class="nav-number">4.2.2.</span> <span class="nav-text">MIME</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#读取协议"><span class="nav-number">4.3.</span> <span class="nav-text">读取协议</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#POP3"><span class="nav-number">4.3.1.</span> <span class="nav-text">POP3</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#IMAP"><span class="nav-number">4.3.2.</span> <span class="nav-text">IMAP</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#P2P-应用"><span class="nav-number">5.</span> <span class="nav-text">P2P 应用</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#危害"><span class="nav-number">5.1.</span> <span class="nav-text">危害</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#索引"><span class="nav-number">5.2.</span> <span class="nav-text">索引</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#FTP"><span class="nav-number">6.</span> <span class="nav-text">FTP</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#DHCP"><span class="nav-number">7.</span> <span class="nav-text">DHCP</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#TELNET"><span class="nav-number">8.</span> <span class="nav-text">TELNET</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#网络编程"><span class="nav-number">9.</span> <span class="nav-text">网络编程</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#处理单个连接请求"><span class="nav-number">9.1.</span> <span class="nav-text">处理单个连接请求</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#处理多个连接请求"><span class="nav-number">9.2.</span> <span class="nav-text">处理多个连接请求</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#异步-IO-处理多个请求"><span class="nav-number">9.3.</span> <span class="nav-text">异步 IO 处理多个请求</span></a></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Apathy"
      src="http://wx4.sinaimg.cn/mw690/006qmw33ly8fzvcxv7effj30ru0ruaby.jpg">
  <p class="site-author-name" itemprop="name">Apathy</p>
  <div class="site-description" itemprop="description">没有肆意生长的野心<br>哪来梦想的星辰大海</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">34</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">18</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/dzapathy" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;dzapathy" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i>GitHub</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>   
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/medium-zoom@1/dist/medium-zoom.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/lozad@1/dist/lozad.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/pangu@4/dist/browser/pangu.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  
      

<script>
  if (typeof MathJax === 'undefined') {
    window.MathJax = {
      tex: {
        inlineMath: {'[+]': [['$', '$']]},
        tags: 'ams'
      },
      options: {
        renderActions: {
          findScript: [10, doc => {
            document.querySelectorAll('script[type^="math/tex"]').forEach(node => {
              const display = !!node.type.match(/; *mode=display/);
              const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display);
              const text = document.createTextNode('');
              node.parentNode.replaceChild(text, node);
              math.start = {node: text, delim: '', n: 0};
              math.end = {node: text, delim: '', n: 0};
              doc.math.push(math);
            });
          }, '', false],
          insertedScript: [200, () => {
            document.querySelectorAll('mjx-container').forEach(node => {
              let target = node.parentNode;
              if (target.nodeName.toLowerCase() === 'li') {
                target.parentNode.classList.add('has-jax');
              }
            });
          }, '', false]
        }
      }
    };
    (function () {
      var script = document.createElement('script');
      script.src = '//cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js';
      script.defer = true;
      document.head.appendChild(script);
    })();
  } else {
    MathJax.startup.document.state(0);
    MathJax.texReset();
    MathJax.typeset();
  }
</script>

    

  

</body>
</html>
